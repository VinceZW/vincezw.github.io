<!DOCTYPE html><html lang="en-gb"><head><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no"><title>光与影 - Vince 自习室</title><meta name="robots" content="noindex,nofollow"><meta name="generator" content="Publii Open-Source CMS for Static Site"><link rel="alternate" type="application/atom+xml" href="https://vincezw.github.io/feed.xml"><link rel="alternate" type="application/json" href="https://vincezw.github.io/feed.json"><meta property="og:title" content="光与影"><meta property="og:image" content="https://vincezw.github.io/media/posts/2/dave-dollar-sl1CuAk__OE-unsplash.jpg"><meta property="og:site_name" content="Vince 自习室"><meta property="og:description" content="1. Lighting 2. shadow 在执行玩剔除之后 ，就需要去渲染阴影贴图。 阴影贴图本质上是一个深度图，把摄像机放在灯光的位置来获取 首先 ，我们需要一个renderTexture 来生成一个阴影贴图&hellip;"><meta property="og:url" content="https://vincezw.github.io/tie-zi-2.html"><meta property="og:type" content="article"><link rel="shortcut icon" href="https://vincezw.github.io/media/website/vince.png" type="image/png"><link rel="stylesheet" href="https://vincezw.github.io/assets/css/fontawesome-all.min.css?v=d6b35e024e2e8667ed9c924ff9fe57cf"><link rel="stylesheet" href="https://vincezw.github.io/assets/css/style.css?v=94925ff69c43e80d17a733aa4bc2312e"><noscript><link rel="stylesheet" href="https://vincezw.github.io/assets/css/noscript.css?v=6228c7eee614cd200a2cad8333b439fa"></noscript><script type="application/ld+json">{"@context":"http://schema.org","@type":"Article","mainEntityOfPage":{"@type":"WebPage","@id":"https://vincezw.github.io/tie-zi-2.html"},"headline":"光与影","datePublished":"2022-07-13T10:55","dateModified":"2022-07-14T13:52","image":{"@type":"ImageObject","url":"https://vincezw.github.io/media/posts/2/dave-dollar-sl1CuAk__OE-unsplash.jpg","height":1536,"width":2048},"description":"1. Lighting 2. shadow 在执行玩剔除之后 ，就需要去渲染阴影贴图。 阴影贴图本质上是一个深度图，把摄像机放在灯光的位置来获取 首先 ，我们需要一个renderTexture 来生成一个阴影贴图&hellip;","author":{"@type":"Person","name":"Vince","url":"https://vincezw.github.io/authors/vince/"},"publisher":{"@type":"Organization","name":"Vince"}}</script><style>#wrapper > .bg {
               background-image: url(https://vincezw.github.io/assets/images/overlay.png), linear-gradient(0deg, rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1)), url();
           }</style></head><body class="is-preload"><div id="wrapper"><header id="header"><a class="logo" href="https://vincezw.github.io/">Vince 自习室</a></header><nav id="nav"><ul class="links"><li><a href="https://vincezw.github.io/" title="最新的和精选的内容" target="_self">最新</a></li><li><a href="https://vincezw.github.io/tags/sda-a/" title="记录的Blog和优秀的文章" target="_self">博客</a></li><li class="asdad"><a href="www.baidu.com" title="尽可能你会用到的资产" target="_self" rel="asdas">资源</a></li><li class="asdad"><a href="https://vincezw.github.io/authors/vince/" title="快速启动灵感的demo小样及工程源文件" target="_self" rel="asdas">TIPS</a></li><li class="asdad"><a href="https://vincezw.github.io/tags/" title="如果你遇到了一些困难不知道如何解决" target="_self" rel="asdas">着色器</a></li><li class="asdad"><a href="https://vincezw.github.io/tags/" title="如果你遇到了一些困难不知道如何解决" target="_self" rel="asdas">技术问题</a></li><li class="asdad"><a href="www.baidu.com" title="并不是很重要的自我简介" target="_self" rel="asdas">关于</a></li><li><a href="https://vincezw.github.io/tags/sda-a/" title="这里会存放一些，由我本人制作且惨不忍睹的糟糕CG图像" target="_self" rel="asdas">画廊</a></li></ul><ul class="icons"><li><a href="https://mp.weixin.qq.com/s/igu_NmhpXG129GE4btQh5g" class="icon brands fa-weixin"><span class="label">Twitter</span></a></li><li><a href="https://ti.qq.com/open_qq/index2.html?url&#x3D;mqqapi%3A%2F%2Fuserprofile%2Ffriend_profile_card%3Fsrc_type%3Dweb%26version%3D1.0%26source%3D2%26uin%3D867633544" class="icon brands fa-qq"><span class="label">Facebook</span></a></li></ul></nav><main id="main"><article class="post"><header class="major"><time datetime="2022-07-13T10:55" class="date">07/13/2022</time><h1>光与影</h1><p class="post__inner">资源来源网络仅供学习交流使用</p></header><figure class="image main"><img src="https://vincezw.github.io/media/posts/2/dave-dollar-sl1CuAk__OE-unsplash.jpg" srcset="https://vincezw.github.io/media/posts/2/responsive/dave-dollar-sl1CuAk__OE-unsplash-xs.jpg 300w, https://vincezw.github.io/media/posts/2/responsive/dave-dollar-sl1CuAk__OE-unsplash-sm.jpg 480w, https://vincezw.github.io/media/posts/2/responsive/dave-dollar-sl1CuAk__OE-unsplash-md.jpg 768w, https://vincezw.github.io/media/posts/2/responsive/dave-dollar-sl1CuAk__OE-unsplash-lg.jpg 1024w, https://vincezw.github.io/media/posts/2/responsive/dave-dollar-sl1CuAk__OE-unsplash-xl.jpg 1360w" sizes="(max-width: 1360px) 100vw, 1360px" loading="lazy" height="1536" width="2048" alt=""></figure><div class="post__inner post__entry"><p>1. Lighting<br>2. shadow<br>在执行玩剔除之后 ，就需要去渲染阴影贴图。<br>阴影贴图本质上是一个深度图，把摄像机放在灯光的位置来获取<br><br>首先 ，我们需要一个renderTexture 来生成一个阴影贴图<br><br>        // 生成一张阴影贴图 <br>        shadowMap = RenderTexture.GetTemporary(<br>            shadowMapSize, shadowMapSize, 16, RenderTextureFormat.Shadowmap        );<br>        //将纹理的滤镜模式设置为双线性,并使用clamp<br>        shadowMap.filterMode = FilterMode.Bilinear;<br>        shadowMap.wrapMode = TextureWrapMode.Clamp;<br>之后，我们把这张图与commandbuffer绑定<br><br>// 渲染阴影之前，我们首先告诉GPU渲染到阴影贴图 CoreUtils.SetRenderTarget(ShadowBuffer , shadowMap,RenderBufferLoadAction.DontCare,RenderBufferStoreAction.Store,ClearFlag.Depth);<br>现在就开始渲染纹理了<br><br>        // 开始渲染纹理 <br>        ShadowBuffer.BeginSample("Render Shadows");<br>        context.ExecuteCommandBuffer(ShadowBuffer);<br>        ShadowBuffer.Clear();<br>我们需要对场景中所有的灯，只要他的设置为阴影投射，那么我们就得为他指定一个深度图<br><br>for (var i = 0; i &lt; _cull.visibleLights.Count; i++){<br>    // 超过最大的灯 <br>    if (i == maxVisibleLights) break;<br>    // 强度为 0 <br>    if (shadowData[i].x &lt;= 0f) continue;}<br>之后，我们需要得到相机位置的 V p 矩阵 unity有方法为我们计算<br><br>// V P 矩阵 viewMatrix and projectionMatrix if (!_cull.ComputeSpotShadowMatricesAndCullingPrimitives(<br>        i, out var viewMatrix, out var projectionMatrix, out var splitData)) {<br>    //如果失败则跳过灯 将强度设置为零<br>    shadowData[i].x = 0f;<br>    continue;}<br>之后，把得到的vp矩阵传入shader<br><br>// 设置矩阵 ，执行并清除ShadowBuffer.SetViewProjectionMatrices(viewMatrix, projectionMatrix);ShadowBuffer.SetGlobalFloat(shadowBiasId, _cull.visibleLights[i].light.shadowBias);context.ExecuteCommandBuffer(ShadowBuffer);ShadowBuffer.Clear();<br>因为 dx 和 opengl 的 zbuffer 是反着的，所以我们还要处理一下<br><br>// 是否反转矩阵 if (SystemInfo.usesReversedZBuffer) {<br>    projectionMatrix.m20 = -projectionMatrix.m20;<br>    projectionMatrix.m21 = -projectionMatrix.m21;<br>    projectionMatrix.m22 = -projectionMatrix.m22;<br>    projectionMatrix.m23 = -projectionMatrix.m23;}Created by miccall (转载请注明出处 miccall.tech)<br> </p></div><footer class="post__inner post__footer"><p class="post__last-updated">本文更新于 07/14/2022</p><div class="post__share-tag-container"><div class="post__tag"><h3>在标记:</h3><ul><li><a href="https://vincezw.github.io/tags/ji-shu/">技术</a></li></ul></div><div class="post__share"><button class="post__share-button js-post__share-button icon" aria-label="分享按钮"><i class="fas fa-share-alt"></i></button><div class="post__share-popup js-post__share-popup"><a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fvincezw.github.io%2Ftie-zi-2.html" class="js-share icon brands fa-facebook-f" rel="nofollow noopener noreferrer"><span class="label">Facebook</span> </a><a href="https://twitter.com/share?url=https%3A%2F%2Fvincezw.github.io%2Ftie-zi-2.html&amp;via=Vince%20%E8%87%AA%E4%B9%A0%E5%AE%A4&amp;text=%E5%85%89%E4%B8%8E%E5%BD%B1" class="js-share icon brands fa-twitter" rel="nofollow noopener noreferrer"><span class="label">Twitter</span> </a><a href="https://pinterest.com/pin/create/button/?url=https%3A%2F%2Fvincezw.github.io%2Ftie-zi-2.html&amp;media=https%3A%2F%2Fvincezw.github.io%2Fmedia%2Fposts%2F2%2Fdave-dollar-sl1CuAk__OE-unsplash.jpg&amp;description=%E5%85%89%E4%B8%8E%E5%BD%B1" class="js-share icon brands fa-pinterest" rel="nofollow noopener noreferrer"><span class="label">Pinterest</span> </a><a href="https://mix.com/add?url=https%3A%2F%2Fvincezw.github.io%2Ftie-zi-2.html" class="js-share icon brands fa-mix" rel="nofollow noopener noreferrer"><span class="label">Mix</span> </a><a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Fvincezw.github.io%2Ftie-zi-2.html" class="js-share icon brands fa-linkedin" rel="nofollow noopener noreferrer"><span class="label">LinkedIn</span> </a><a href="https://buffer.com/add?text=%E5%85%89%E4%B8%8E%E5%BD%B1&amp;url=https%3A%2F%2Fvincezw.github.io%2Ftie-zi-2.html" class="js-share icon brands fa-buffer" rel="nofollow noopener noreferrer"><span class="label">Buffer</span> </a><a href="https://api.whatsapp.com/send?text=%E5%85%89%E4%B8%8E%E5%BD%B1 https%3A%2F%2Fvincezw.github.io%2Ftie-zi-2.html" class="js-share icon brands fa-whatsapp" rel="nofollow noopener noreferrer"><span class="label">WhatsApp</span></a></div></div></div><div class="post__bio"><div><h3><a href="https://vincezw.github.io/authors/vince/" class="invert" rel="author">Vince</a></h3></div></div></footer></article><div class="post__comments"><div class="wrapper"><div class="comments"><div class="comments-wrapper"><h2>留言板</h2><div id="cusdis_thread" data-host="https://cusdis.com" data-app-id="65aefc95-1a07-49ac-9b20-5cc6cf715b59" data-page-id="2" data-page-url="https://vincezw.github.io/tie-zi-2.html" data-page-title="光与影" data-theme="auto"></div><noscript>Please enable JS to use the comments form.</noscript><script type="text/javascript">(function () {
				var d = document, s = d.createElement('script');
				s.src = 'https://cusdis.com/js/cusdis.es.js';
				s.defer = true;
				(d.head || d.body).appendChild(s);
			})();</script><script type="text/javascript"></script></div></div></div></div><div><strong>为你推荐相关文章:</strong></div><div class="posts"><article><header><time datetime="2022-07-12T16:45" class="date">07/12/2022</time><h2><a href="https://vincezw.github.io/tie-zi-5.html">【建筑建模渲染总结】by SU+ENS</a></h2></header><a href="https://vincezw.github.io/tie-zi-5.html" class="image fit"><img src="https://vincezw.github.io/media/posts/5/Honeyview_3DYuan-Qu.jpg" srcset="https://vincezw.github.io/media/posts/5/responsive/Honeyview_3DYuan-Qu-xs.jpg 300w, https://vincezw.github.io/media/posts/5/responsive/Honeyview_3DYuan-Qu-sm.jpg 480w, https://vincezw.github.io/media/posts/5/responsive/Honeyview_3DYuan-Qu-md.jpg 768w, https://vincezw.github.io/media/posts/5/responsive/Honeyview_3DYuan-Qu-lg.jpg 1024w, https://vincezw.github.io/media/posts/5/responsive/Honeyview_3DYuan-Qu-xl.jpg 1360w" sizes="(max-width: 1360px) 100vw, 1360px" loading="lazy" height="1577" width="1920" alt=""></a><p></p><ul class="actions special"><li><a href="https://vincezw.github.io/tie-zi-5.html" class="button">全文</a></li></ul></article><article><header><time datetime="2022-07-12T16:43" class="date">07/12/2022</time><h2><a href="https://vincezw.github.io/tie-zi-1.html">这是一个巨大的标题</a></h2></header><p></p><p class="align-center">Aenean ornare velit lacus varius enim ullamcorper proin aliquam<br>facilisis ante sed etiam magna interdum congue。Lorem ipsum dolor<br>amet nullam sed etiam vereroros。</p><figure class="post__image"><img loading="lazy" src="https://vincezw.github.io/media/posts/1/mo-gabrail-iuC3w8mLDcs-unsplash.jpg" sizes="(max-width: 48em) 100vw, 768px" srcset="https://vincezw.github.io/media/posts/1/responsive/mo-gabrail-iuC3w8mLDcs-unsplash-xs.jpg 300w, https://vincezw.github.io/media/posts/1/responsive/mo-gabrail-iuC3w8mLDcs-unsplash-sm.jpg 480w, https://vincezw.github.io/media/posts/1/responsive/mo-gabrail-iuC3w8mLDcs-unsplash-md.jpg 768w, https://vincezw.github.io/media/posts/1/responsive/mo-gabrail-iuC3w8mLDcs-unsplash-lg.jpg 1024w, https://vincezw.github.io/media/posts/1/responsive/mo-gabrail-iuC3w8mLDcs-unsplash-xl.jpg 1360w, https://vincezw.github.io/media/posts/1/responsive/mo-gabrail-iuC3w8mLDcs-unsplash-2xl.jpg 1600w" alt="" width="4032" height="3024"></figure><p></p><ul class="actions special"><li><a href="https://vincezw.github.io/tie-zi-1.html" class="button">全文</a></li></ul></article></div></main><footer id="copyright"><ul><li>© Massively</li><li>Design: HTML5 UP</li><li>Powered by Publii</li></ul></footer></div><script src="https://vincezw.github.io/assets/js/jquery.min.js?v=7c14a783dfeb3d238ccd3edd840d82ee"></script><script src="https://vincezw.github.io/assets/js/jquery.scrollex.min.js?v=f89065e3d988006af9791b44561d7c90"></script><script src="https://vincezw.github.io/assets/js/jquery.scrolly.min.js?v=1ed5a78bde1476875a40f6b9ff44fc14"></script><script src="https://vincezw.github.io/assets/js/browser.min.js?v=c07298dd19048a8a69ad97e754dfe8d0"></script><script src="https://vincezw.github.io/assets/js/breakpoints.min.js?v=81a479eb099e3b187613943b085923b8"></script><script src="https://vincezw.github.io/assets/js/util.min.js?v=4201a626f8c9b614a663b3a1d7d82615"></script><script src="https://vincezw.github.io/assets/js/main.min.js?v=56233c354bd814758be8bff42f7e13a5"></script><script>/*<![CDATA[*/var images=document.querySelectorAll("img[loading]");for(var i=0;i<images.length;i++){if(images[i].complete){images[i].classList.add("is-loaded")}else{images[i].addEventListener("load",function(){this.classList.add("is-loaded")},false)}};/*]]>*/</script></body></html>